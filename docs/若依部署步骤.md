# 若依（RuoYi-Vue）Jenkins + GitHub + Docker 部署步骤

## 一、前置条件

- WSL 里已安装 Docker、Jenkins（docker-compose 已启动）
- GitHub 账号，能推送代码
- 本仓库的 Jenkins 已配置好 Git 和 Docker

## 二、准备若依代码到 GitHub

### 1. Fork 或克隆若依仓库

```bash
# 若依 Vue 版官方仓库
# https://github.com/yangzongzhuan/RuoYi-Vue

# 方式 A：在 GitHub 网页上 Fork 到你的账号（如 Sean1-rgb/RuoYi-Vue）
# 方式 B：本地克隆后推到自己仓库
git clone https://github.com/yangzongzhuan/RuoYi-Vue.git
cd RuoYi-Vue
git remote set-url origin git@github.com:Sean1-rgb/ruoyi-vue.git  # 改成你的仓库
git push -u origin main
```

### 2. 把部署文件拷进若依项目

把本仓库 `ruoyi-deploy/` 下的文件复制到 **若依项目根目录**：

- `Dockerfile.backend` → 若依项目根目录
- `Dockerfile.ui` → 若依项目根目录  
- `docker-compose.ruoyi.yml` → 若依项目根目录（可改名为 `docker-compose.yml` 或保留原名）
- `Jenkinsfile` → 若依项目根目录（会覆盖或替换原有流水线）
- `nginx.conf` → 若依项目根目录

然后提交并推送：

```bash
cd /path/to/RuoYi-Vue
git add .
git commit -m "ci: 添加 Jenkins + Docker 部署"
git push origin main
```

## 三、Jenkins 里创建若依流水线任务

1. 打开 Jenkins：`http://localhost:8081`（或你改过的端口）
2. **新建任务** → 输入名称如 `ruoyi-vue` → 选 **流水线** → 确定
3. **流水线** 配置：
   - 定义：**Pipeline script from SCM**
   - SCM：**Git**
   - 仓库 URL：`git@github.com:Sean1-rgb/ruoyi-vue.git`（改成你的若依仓库）
   - 凭据：选能访问该仓库的 SSH 或 用户名+Token
   - 分支：`*/main` 或 `*/master`
   - Script Path：`Jenkinsfile`
4. 保存

## 四、首次部署前：MySQL 初始化

若依需要 MySQL 里已有数据库和表结构。

**推荐：用 docker-compose 自带的 MySQL**

- `docker-compose.ruoyi.yml` 已配置：
  - 自动创建数据库 `ry-vue`、用户 `ruoyi`/`ruoyi123`
  - 若依项目里的 `sql/` 目录会挂载到 MySQL 的 `/docker-entrypoint-initdb.d`，**首次启动 MySQL 时会自动执行其中的 .sql**（建表等）
- 若依项目根目录下要有 `sql/` 文件夹，且内含若依的建表脚本（如 `ry_2024xxx.sql`）
- 若 `sql/` 里没有脚本，需首次启动后手动导入：  
  `docker exec -i ruoyi-mysql mysql -uruoyi -pruoyi123 ry-vue < sql/ry_xxxx.sql`

## 五、执行部署

1. 在 Jenkins 里打开任务 `ruoyi-vue`
2. 点击 **立即构建**
3. 构建会：拉代码 → Maven 打包后端 → npm 构建前端 → 构建镜像 → 启动/更新容器
4. 完成后访问：
   - 前端（Nginx）：**http://localhost** 或 http://localhost:80
   - 后端接口：http://localhost:8080
   - 若依默认账号：**admin / admin123**

## 六、只在本机用 Docker 跑若依（不用 Jenkins）

```bash
cd /path/to/RuoYi-Vue
# 确保 MySQL 已起且已导入 sql
docker-compose -f docker-compose.ruoyi.yml up -d
```

然后访问前端地址即可。

## 七、常见问题

- **Jenkins 里 Maven 找不到**：流水线里已用 Docker 跑 Maven（`maven:3-eclipse-temurin-17`），无需在 Jenkins 主机装 Maven。
- **前端请求后端 404**：检查 `nginx.conf` 里 `proxy_pass` 是否指到后端服务名和端口（如 `http://ruoyi-backend:8080`）。
- **后端连不上 MySQL/Redis**：在 docker-compose 里后端服务的环境变量 `MYSQL_HOST`、`REDIS_HOST` 要为服务名 `mysql`、`redis`，且同一 compose 网络。
